- pom

  ```xml
  <!-- sshj 库 -->
  <dependency>
      <groupId>com.hierynomus</groupId>
      <artifactId>sshj</artifactId>
      <version>0.29.0</version>
  </dependency>
  
  <!-- Spring Boot 相关依赖 -->
  <dependency>
      <groupId>org.springframework.boot</groupId>
      <artifactId>spring-boot-starter-web</artifactId>
      <version>2.5.4</version>
  </dependency>
  <dependency>
      <groupId>org.springframework.boot</groupId>
      <artifactId>spring-boot-devtools</artifactId>
      <version>2.5.4</version>
  </dependency>
  <dependency>
      <groupId>org.springframework.boot</groupId>
      <artifactId>spring-boot-starter-websocket</artifactId>
      <version>2.5.4</version>
  </dependency>
  ```

- Java代码

  ```java
  import org.springframework.context.annotation.Configuration;
  import org.springframework.web.socket.WebSocketHandler;
  import org.springframework.web.socket.config.annotation.EnableWebSocket;
  import org.springframework.web.socket.config.annotation.WebSocketConfigurer;
  import org.springframework.web.socket.config.annotation.WebSocketHandlerRegistry;
  import org.springframework.web.socket.server.standard.ServletServerContainerFactoryBean;
  
  @Configuration
  @EnableWebSocket
  public class WebSocketConfig implements WebSocketConfigurer {
      @Override
      public void registerWebSocketHandlers(WebSocketHandlerRegistry webSocketHandlerRegistry) {
          webSocketHandlerRegistry.addHandler(new SSHHandler(), "/ssh");
      }
  
      public static class SSHHandler implements WebSocketHandler {
          private SSHClient sshClient = new SSHClient();
  
          @Override
          public void afterConnectionEstablished(WebSocketSession session) throws Exception {
              sshClient.connect();
              sshClient.authenticate();
              ChannelShell channelShell = sshClient.createShell();
              // 启动协程，将 SSH 服务器返回的数据写入 WebSocket
              Executors.newSingleThreadExecutor().execute(new ReadFromSSHServer(session, channelShell));
  
              session.getAttributes().put("channel", channelShell);
          }
  
          @Override
          public void handleMessage(WebSocketSession session, WebSocketMessage<?> message) throws Exception {
              ChannelShell channelShell = (ChannelShell) session.getAttributes().get("channel");
              channelShell.getOutputStream().write(message.getPayload().toString().getBytes());
          }
  
          @Override
          public void afterConnectionClosed(WebSocketSession session, CloseStatus closeStatus) throws Exception {
              ChannelShell channelShell = (ChannelShell) session.getAttributes().get("channel");
              channelShell.close();
              sshClient.close();
          }
  
          @Override
          public void handleTransportError(WebSocketSession session, Throwable exception) throws Exception {
              exception.printStackTrace();
          }
      }
  
      // SSH 客户端连接实现类
      public static class SSHClient {
          private SSHClientConfig config;
          private SSHClientImpl client;
  
          public void connect() throws IOException {
              this.config = SSHClientConfig.create();
              this.client = new SSHClientImpl();
              client.connect(config.getHost(), config.getPort());
          }
  
          public void authenticate() throws IOException {
              client.authPassword(config.getUsername(), config.getPassword());
              client.setUseCompression();
          }
  
          public ChannelShell createShell() throws IOException {
              return client.startSession().allocateDefaultShell();
          }
  
          public void close() throws IOException {
              client.disconnect();
          }
      }
  
      // 从 SSH 服务器读取数据并写入 WebSocket 的协程
      private static class ReadFromSSHServer implements Runnable {
          private final WebSocketSession session;
          private final ChannelShell channelShell;
  
          public ReadFromSSHServer(WebSocketSession session, ChannelShell channelShell) {
              this.session = session;
              this.channelShell = channelShell;
          }
  
          @Override
          public void run() {
              try {
                  InputStream inputStream = channelShell.getInputStream();
                  byte[] buffer = new byte[8192];
                  while (!channelShell.isClosed()) {
                      // 从 SSH 服务器读取数据
                      int readBytes = inputStream.read(buffer);
                      if (readBytes > 0) {
                          // 将 SSH 服务器返回的数据写入 WebSocket
                          TextMessage message = new TextMessage(new String(buffer, 0, readBytes));
                          session.sendMessage(message);
                      }
                  }
              } catch (Exception e) {
                  e.printStackTrace();
              }
          }
      }
  
      // SSH 客户端连接配置类
      public static class SSHClientConfig {
          // 从配置文件中获取 SSH 服务器的连接参数
          private String host;
          private Integer port;
          private String username;
          private String password;
  
          public static SSHClientConfig create() throws IOException {
              final Properties properties = new Properties();
              FileReader reader = new FileReader("./ssh.properties");
              properties.load(reader);
  
              SSHClientConfig config = new SSHClientConfig();
              config.host = properties.getProperty("ssh.host");
              config.port = Integer.parseInt(properties.getProperty("ssh.port", "22"));
              config.username = properties.getProperty("ssh.username");
              config.password = properties.getProperty("ssh.password");
  
              return config;
          }
  
          public String getHost() {
              return host;
          }
  
          public void setHost(String host) {
              this.host = host;
          }
  
          public Integer getPort() {
              return port;
          }
  
          public void setPort(Integer port) {
              this.port = port;
          }
  
          public String getUsername() {
              return username;
          }
  
          public void setUsername(String username) {
              this.username = username;
          }
  
          public String getPassword() {
              return password;
          }
  
          public void setPassword(String password) {
              this.password = password;
          }
      }
  }
  ```

  











```Java
import com.jcraft.jsch.*;

import java.io.IOException;
import java.io.InputStream;

public class SSHConnection {

    public static void main(String[] args) {
        String host = "your_host_name"; // 远程服务器的主机名或IP地址
        String user = "your_user_name"; // 远程服务器的用户名
        String password = "your_password"; // 远程服务器的密码

        try {
            JSch jsch = new JSch(); // 创建JSch对象
            Session session = jsch.getSession(user, host, 22); // 创建SSH会话对象
            session.setPassword(password); // 设置会话密码
            session.setConfig("StrictHostKeyChecking", "no"); // 设置会话配置，取消主机密钥检查
            session.connect(); // 连接到远程服务器

            Channel channel = session.openChannel("exec"); // 打开exec通道
            ((ChannelExec) channel).setCommand("ls -l"); // 设置要执行的命令
            channel.setInputStream(null); // 设置通道输入流为空
            ((ChannelExec) channel).setErrStream(System.err); // 设置通道错误输出流为标准错误输出流

            InputStream in = channel.getInputStream(); // 获取通道输入流
            channel.connect(); // 连接到远程服务器并执行命令

            byte[] tmp = new byte[1024];
            while (true) {
                while (in.available() > 0) {
                    int i = in.read(tmp, 0, 1024);
                    if (i < 0) break;
                    System.out.print(new String(tmp, 0, i)); // 打印命令输出
                }
                if (channel.isClosed()) {
                    if (in.available() > 0) continue;
                    System.out.println("exit-status: " + channel.getExitStatus()); // 打印命令执行结果
                    break;
                }
                try {
                    Thread.sleep(1000); // 等待命令执行完成
                } catch (Exception ee) {
                }
            }
            channel.disconnect(); // 断开通道连接
            session.disconnect(); // 断开会话连接
        } catch (JSchException | IOException e) {
            e.printStackTrace(); // 打印异常信息
        }
    }
}
```

